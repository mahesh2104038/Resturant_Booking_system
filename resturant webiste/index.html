<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #2c3e50, #1a2530);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
            color: #e74c3c;
        }

        .auth-section {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .primary-btn {
            background-color: #e74c3c;
            color: white;
        }

        .primary-btn:hover {
            background-color: #c0392b;
        }

        .secondary-btn {
            background-color: #3498db;
            color: white;
        }

        .secondary-btn:hover {
            background-color: #2980b9;
        }

        .outline-btn {
            background-color: transparent;
            border: 2px solid #3498db;
            color: #3498db;
        }

        .outline-btn:hover {
            background-color: #3498db;
            color: white;
        }

        .view-section {
            display: none;
            margin-top: 20px;
        }

        .active-view {
            display: block;
        }

        .section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        h2 {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #f1f1f1;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }

        h2 i {
            margin-right: 10px;
            color: #e74c3c;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .menu-item {
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .menu-item img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .menu-item h3 {
            margin: 10px 0;
            color: #2c3e50;
        }

        .menu-item p {
            color: #666;
            flex-grow: 1;
            font-size: 0.9rem;
        }

        .price {
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
            font-size: 1.2rem;
        }

        .order-btn {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .order-btn:hover {
            background-color: #1a2530;
        }

        .order-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .current-order {
            flex: 1;
            min-width: 300px;
        }

        .order-items {
            list-style-type: none;
            margin-top: 10px;
        }

        .order-items li {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-items li:nth-child(odd) {
            background-color: #f9f9f9;
        }

        .order-total {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 15px;
            text-align: right;
            color: #2c3e50;
        }

        .admin-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .admin-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        input, select, textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: 500;
            color: #2c3e50;
        }

        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .order-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #fff;
        }

        .order-card h3 {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .prep-time {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }

        .prep-time input {
            width: 80px;
        }

        .timer {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.1rem;
        }

        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 25px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #2ecc71;
            color: white;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
        }

        .view-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            background-color: #ddd;
            padding: 12px 24px;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-weight: 500;
        }

        .tab-button.active {
            background-color: #2c3e50;
            color: white;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-pending {
            background-color: #f39c12;
            color: white;
        }

        .status-preparing {
            background-color: #3498db;
            color: white;
        }

        .status-ready {
            background-color: #2ecc71;
            color: white;
        }

        .qr-section {
            text-align: center;
            padding: 20px;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background-color: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            color: #2c3e50;
            border-radius: 8px;
        }

        .bill-section {
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .bill-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .bill-details {
            margin-bottom: 20px;
        }

        .bill-items {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .bill-items th, .bill-items td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .bill-total {
            text-align: right;
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .admin-panel {
                grid-template-columns: 1fr;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .auth-section {
                flex-direction: column;
                width: 100%;
            }
            
            .auth-section button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-utensils"></i>
                <span>Restaurant Management System</span>
            </div>
            <div class="auth-section" id="auth-section">
                <div class="user-info" id="user-info" style="display: none;">
                    <div class="avatar" id="user-avatar">U</div>
                    <div>
                        <div id="user-name">User</div>
                        <div id="user-role" style="font-size: 0.8rem; color: #ccc;">Role</div>
                    </div>
                </div>
                <button id="login-btn" class="primary-btn">Login</button>
                <button id="logout-btn" class="outline-btn" style="display: none;">Logout</button>
            </div>
        </header>

        <!-- QR Code View -->
        <div id="qr-view" class="view-section active-view">
            <div class="section qr-section">
                <h2><i class="fas fa-qrcode"></i> Scan QR Code to Order</h2>
                <div class="qr-code">
                    <i class="fas fa-qrcode"></i>
                </div>
                <p style="margin-top: 20px;">Scan this QR code with your phone to view our menu and place an order</p>
                <button class="primary-btn" style="margin-top: 20px;" onclick="showMenu()">View Menu</button>
            </div>
        </div>

        <!-- Customer View -->
        <div id="customer-view" class="view-section">
            <div class="section">
                <h2><i class="fas fa-utensils"></i> Menu</h2>
                <div class="menu-grid" id="customer-menu">
                    <!-- Menu items will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="section">
                <h2><i class="fas fa-shopping-cart"></i> Your Order</h2>
                <div class="order-section">
                    <div class="current-order">
                        <div class="form-group">
                            <label for="customer-name">Your Name:</label>
                            <input type="text" id="customer-name" placeholder="Enter your name">
                        </div>
                        <div class="form-group">
                            <label for="customer-table">Table Number:</label>
                            <input type="number" id="customer-table" min="1" placeholder="Table number">
                        </div>
                        <ul class="order-items" id="customer-order-items">
                            <!-- Order items will be populated by JavaScript -->
                        </ul>
                        <div class="order-total">Total: $<span id="customer-total">0.00</span></div>
                        <button class="primary-btn" style="margin-top: 15px;" onclick="placeOrder()">Place Order</button>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2><i class="fas fa-clock"></i> Order Status</h2>
                <div id="order-status">
                    <p>No active orders</p>
                </div>
            </div>
        </div>

        <!-- Login View -->
        <div id="login-view" class="view-section">
            <div class="login-container">
                <h2><i class="fas fa-sign-in-alt"></i> Staff Login</h2>
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password">
                </div>
                <button class="primary-btn" style="width: 100%; margin-top: 15px;" onclick="login()">Login</button>
                
                <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
                    <h3>Demo Credentials:</h3>
                    <p><strong>Admin:</strong> admin / admin123</p>
                    <p><strong>Waiter:</strong> waiter / waiter123</p>
                </div>
            </div>
        </div>

        <!-- Waiter View -->
        <div id="waiter-view" class="view-section">
            <div class="section">
                <h2><i class="fas fa-concierge-bell"></i> Take Order</h2>
                <div class="menu-grid" id="waiter-menu">
                    <!-- Menu items will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="section">
                <h2><i class="fas fa-clipboard-list"></i> Current Order</h2>
                <div class="order-section">
                    <div class="current-order">
                        <div class="form-group">
                            <label for="table-number">Table Number:</label>
                            <input type="number" id="table-number" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="customer-name-waiter">Customer Name:</label>
                            <input type="text" id="customer-name-waiter" placeholder="Customer name">
                        </div>
                        <ul class="order-items" id="waiter-order-items">
                            <!-- Order items will be populated by JavaScript -->
                        </ul>
                        <div class="order-total">Total: $<span id="waiter-total">0.00</span></div>
                        <button class="primary-btn" style="margin-top: 15px;" onclick="submitOrder()">Submit to Kitchen</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin View -->
        <div id="admin-view" class="view-section">
            <div class="view-buttons">
                <div class="tab-button active" onclick="switchAdminTab('orders')">Orders</div>
                <div class="tab-button" onclick="switchAdminTab('menu')">Menu Management</div>
                <div class="tab-button" onclick="switchAdminTab('reports')">Daily Reports</div>
            </div>
            
            <div id="admin-orders-tab">
                <div class="section">
                    <h2><i class="fas fa-tasks"></i> Current Orders</h2>
                    <div class="orders-list" id="orders-list">
                        <!-- Orders will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div id="admin-menu-tab" class="hidden">
                <div class="section">
                    <h2><i class="fas fa-plus-circle"></i> Add Menu Item</h2>
                    <div class="admin-form">
                        <div class="form-group">
                            <label for="item-name">Item Name</label>
                            <input type="text" id="item-name" placeholder="Item Name">
                        </div>
                        <div class="form-group">
                            <label for="item-description">Description</label>
                            <textarea id="item-description" placeholder="Description"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="item-price">Price</label>
                            <input type="number" id="item-price" placeholder="Price" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="item-image">Image URL</label>
                            <input type="text" id="item-image" placeholder="Image URL">
                        </div>
                        <button class="primary-btn" onclick="addMenuItem()">Add Item</button>
                    </div>
                </div>
                
                <div class="section">
                    <h2><i class="fas fa-list"></i> Menu Items</h2>
                    <div class="menu-grid" id="admin-menu">
                        <!-- Menu items will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div id="admin-reports-tab" class="hidden">
                <div class="section">
                    <h2><i class="fas fa-chart-bar"></i> Daily Reports</h2>
                    <div class="form-group">
                        <label for="report-date">Select Date:</label>
                        <input type="date" id="report-date">
                    </div>
                    <button class="primary-btn" onclick="generateDailyReport()">Generate Report</button>
                    
                    <div id="report-results" style="margin-top: 20px;">
                        <!-- Report results will be displayed here -->
                    </div>
                </div>
                
                <div class="section">
                    <h2><i class="fas fa-download"></i> Export Data</h2>
                    <button class="primary-btn" onclick="exportOrders()">Export All Orders</button>
                    <button class="secondary-btn" style="margin-left: 10px;" onclick="exportTodayOrders()">Export Today's Orders</button>
                </div>
            </div>
        </div>

        <!-- Bill Section -->
        <div class="bill-section" id="bill-section">
            <div class="bill-header">
                <h2>Restaurant Bill</h2>
                <p id="bill-number">Bill #: </p>
                <p id="bill-date">Date: </p>
            </div>
            
            <div class="bill-details">
                <p id="bill-customer">Customer: </p>
                <p id="bill-table">Table: </p>
            </div>
            
            <table class="bill-items">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="bill-items">
                    <!-- Bill items will be populated by JavaScript -->
                </tbody>
            </table>
            
            <div class="bill-total">
                Total: $<span id="bill-total">0.00</span>
            </div>
            
            <button class="primary-btn" onclick="downloadBill()" style="margin-top: 20px;">
                <i class="fas fa-download"></i> Download Bill
            </button>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // User data with username and password
        const users = [
            { id: 1, username: 'admin', password: 'admin123', role: 'admin', name: 'Admin User' },
            { id: 2, username: 'waiter', password: 'waiter123', role: 'waiter', name: 'John Waiter' }
        ];

        // Sample menu data
        let menuItems = [
            { id: 1, name: "Margherita Pizza", description: "Classic pizza with tomato sauce and mozzarella", price: 12.99, image: "https://images.unsplash.com/photo-1513104890138-7c749659a591?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=870&q=80" },
            { id: 2, name: "Caesar Salad", description: "Fresh romaine lettuce with Caesar dressing and croutons", price: 8.99, image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=870&q=80" },
            { id: 3, name: "Burger", description: "Beef patty with lettuce, tomato, and special sauce", price: 10.99, image: "https://images.unsplash.com/photo-1553979459-d2229ba7433b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=868&q=80" },
            { id: 4, name: "Pasta Carbonara", description: "Spaghetti with creamy sauce, pancetta, and parmesan", price: 14.99, image: "https://images.unsplash.com/photo-1621996346565-e3dbc353d2e5?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=580&q=80" }
        ];

        // Orders data
        let orders = [];
        let currentOrder = [];
        let orderIdCounter = 1;
        let currentUser = null;
        let completedOrders = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            renderMenu();
            updateOrderDisplay();
            
            // Set up event listeners
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('login-btn').addEventListener('click', showLogin);
            
            // Set today's date as default for reports
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('report-date').value = today;
        });

        // Show login view
        function showLogin() {
            hideAllViews();
            document.getElementById('login-view').classList.add('active-view');
        }

        // Show menu view (for customers)
        function showMenu() {
            hideAllViews();
            document.getElementById('customer-view').classList.add('active-view');
        }

        // Hide all views
        function hideAllViews() {
            document.querySelectorAll('.view-section').forEach(view => {
                view.classList.remove('active-view');
            });
        }

        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Find user with matching credentials
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                showNotification('Login successful! Welcome ' + user.name);
                
                // Update UI for logged in user
                document.getElementById('user-name').textContent = user.name;
                document.getElementById('user-role').textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1);
                document.getElementById('user-avatar').textContent = user.name.charAt(0);
                document.getElementById('user-info').style.display = 'flex';
                document.getElementById('login-btn').style.display = 'none';
                document.getElementById('logout-btn').style.display = 'block';
                
                // Hide login view and show appropriate view based on role
                document.getElementById('login-view').classList.remove('active-view');
                showView(`${user.role}-view`);
            } else {
                showNotification('Invalid username or password', true);
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('login-btn').style.display = 'block';
            document.getElementById('logout-btn').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            // Show QR view
            hideAllViews();
            document.getElementById('qr-view').classList.add('active-view');
            showNotification('You have been logged out');
        }

        // Show notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.backgroundColor = isError ? '#e74c3c' : '#2ecc71';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Show specific view
        function showView(viewId) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(view => {
                view.classList.remove('active-view');
            });
            
            // Show requested view
            document.getElementById(viewId).classList.add('active-view');
            
            // If admin, make sure orders tab is shown by default
            if (viewId === 'admin-view') {
                switchAdminTab('orders');
            }
        }

        // Switch between admin tabs
        function switchAdminTab(tabName) {
            // Hide all tabs
            document.getElementById('admin-orders-tab').classList.add('hidden');
            document.getElementById('admin-menu-tab').classList.add('hidden');
            document.getElementById('admin-reports-tab').classList.add('hidden');
            
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab and set active button
            document.getElementById(`admin-${tabName}-tab`).classList.remove('hidden');
            event.target.classList.add('active');
        }

        // Render menu items in all views
        function renderMenu() {
            // Customer view
            const customerMenu = document.getElementById('customer-menu');
            customerMenu.innerHTML = '';
            menuItems.forEach(item => {
                customerMenu.innerHTML += `
                    <div class="menu-item">
                        <img src="${item.image}" alt="${item.name}">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <div class="price">$${item.price.toFixed(2)}</div>
                        <button class="order-btn" onclick="addToOrder(${item.id})">Add to Order</button>
                    </div>
                `;
            });
            
            // Waiter view
            const waiterMenu = document.getElementById('waiter-menu');
            waiterMenu.innerHTML = '';
            menuItems.forEach(item => {
                waiterMenu.innerHTML += `
                    <div class="menu-item">
                        <img src="${item.image}" alt="${item.name}">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <div class="price">$${item.price.toFixed(2)}</div>
                        <button class="order-btn" onclick="addToOrder(${item.id})">Add to Order</button>
                    </div>
                `;
            });
            
            // Admin view
            const adminMenu = document.getElementById('admin-menu');
            adminMenu.innerHTML = '';
            menuItems.forEach(item => {
                adminMenu.innerHTML += `
                    <div class="menu-item">
                        <img src="${item.image}" alt="${item.name}">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <div class="price">$${item.price.toFixed(2)}</div>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="secondary-btn" onclick="editItem(${item.id})">Edit</button>
                            <button class="primary-btn" onclick="deleteItem(${item.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
        }

        // Add item to current order
        function addToOrder(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (item) {
                const existingItem = currentOrder.find(i => i.id === itemId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    currentOrder.push({...item, quantity: 1});
                }
                updateOrderDisplay();
                showNotification(`${item.name} added to order`);
            }
        }

        // Update order display in all views
        function updateOrderDisplay() {
            // Customer view
            const customerOrderItems = document.getElementById('customer-order-items');
            customerOrderItems.innerHTML = '';
            let total = 0;
            
            if (currentOrder.length === 0) {
                customerOrderItems.innerHTML = '<li>Your order is empty</li>';
            } else {
                currentOrder.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    customerOrderItems.innerHTML += `
                        <li>
                            <span>${item.name} x${item.quantity}</span>
                            <span>$${itemTotal.toFixed(2)}</span>
                        </li>
                    `;
                });
            }
            
            document.getElementById('customer-total').textContent = total.toFixed(2);
            
            // Waiter view
            const waiterOrderItems = document.getElementById('waiter-order-items');
            waiterOrderItems.innerHTML = '';
            let waiterTotal = 0;
            
            if (currentOrder.length === 0) {
                waiterOrderItems.innerHTML = '<li>Order is empty</li>';
            } else {
                currentOrder.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    waiterTotal += itemTotal;
                    waiterOrderItems.innerHTML += `
                        <li>
                            <span>${item.name} x${item.quantity}</span>
                            <span>$${itemTotal.toFixed(2)}</span>
                        </li>
                    `;
                });
            }
            
            document.getElementById('waiter-total').textContent = waiterTotal.toFixed(2);
        }

        // Customer places order
        function placeOrder() {
            if (currentOrder.length === 0) {
                showNotification('Your order is empty!', true);
                return;
            }
            
            const customerName = document.getElementById('customer-name').value;
            const tableNumber = document.getElementById('customer-table').value;
            
            if (!customerName || !tableNumber) {
                showNotification('Please enter your name and table number', true);
                return;
            }
            
            const order = {
                id: orderIdCounter++,
                items: [...currentOrder],
                status: 'pending',
                table: tableNumber,
                customer: customerName,
                total: currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                prepTime: 0,
                timestamp: new Date()
            };
            
            orders.push(order);
            currentOrder = [];
            updateOrderDisplay();
            updateOrdersDisplay();
            
            // Clear customer form
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-table').value = '';
            
            showNotification('Order placed! Your food will be ready soon.');
            
            // Update order status display for customer
            document.getElementById('order-status').innerHTML = `
                <p>Order #${order.id} is being prepared</p>
                <p>Estimated preparation time: <span class="timer">${order.prepTime || 'Not set yet'}</span> minutes</p>
            `;
        }

        // Waiter submits order to kitchen
        function submitOrder() {
            if (currentOrder.length === 0) {
                showNotification('Order is empty!', true);
                return;
            }
            
            const tableNumber = parseInt(document.getElementById('table-number').value) || 1;
            const customerName = document.getElementById('customer-name-waiter').value;
            
            if (!customerName) {
                showNotification('Please enter customer name', true);
                return;
            }
            
            const order = {
                id: orderIdCounter++,
                items: [...currentOrder],
                status: 'pending',
                table: tableNumber,
                customer: customerName,
                total: currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                prepTime: 0,
                timestamp: new Date()
            };
            
            orders.push(order);
            currentOrder = [];
            updateOrderDisplay();
            updateOrdersDisplay();
            
            // Clear waiter form
            document.getElementById('customer-name-waiter').value = '';
            
            showNotification(`Order submitted for table ${tableNumber}!`);
        }

        // Update orders display in admin view
        function updateOrdersDisplay() {
            const ordersList = document.getElementById('orders-list');
            ordersList.innerHTML = '';
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p>No orders at this time</p>';
                return;
            }
            
            orders.forEach(order => {
                let itemsHtml = '';
                order.items.forEach(item => {
                    itemsHtml += `<li>${item.name} x${item.quantity} - $${(item.price * item.quantity).toFixed(2)}</li>`;
                });
                
                let statusBadge = '';
                if (order.status === 'pending') {
                    statusBadge = '<span class="status-badge status-pending">Pending</span>';
                } else if (order.status === 'preparing') {
                    statusBadge = '<span class="status-badge status-preparing">Preparing</span>';
                } else if (order.status === 'ready') {
                    statusBadge = '<span class="status-badge status-ready">Ready</span>';
                }
                
                ordersList.innerHTML += `
                    <div class="order-card">
                        <h3>
                            <span>Order #${order.id} - Table ${order.table} (${order.customer})</span>
                            ${statusBadge}
                        </h3>
                        <ul>${itemsHtml}</ul>
                        <div class="order-total">Total: $${order.total.toFixed(2)}</div>
                        <div class="prep-time">
                            <label>Set preparation time (minutes):</label>
                            <input type="number" id="prep-time-${order.id}" min="1" value="15">
                            <button class="secondary-btn" onclick="setPrepTime(${order.id})">Set Time</button>
                        </div>
                        <div style="margin-top: 10px;">
                            <button class="primary-btn" onclick="completeOrder(${order.id})">Order Ready</button>
                        </div>
                    </div>
                `;
            });
        }

        // Admin sets preparation time for an order
        function setPrepTime(orderId) {
            const prepTime = parseInt(document.getElementById(`prep-time-${orderId}`).value);
            const order = orders.find(o => o.id === orderId);
            
            if (order) {
                order.prepTime = prepTime;
                order.status = 'preparing';
                updateOrdersDisplay();
                
                showNotification(`Preparation time set to ${prepTime} minutes for order #${orderId}`);
            }
        }

        // Mark order as complete and generate bill
        function completeOrder(orderId) {
            const orderIndex = orders.findIndex(o => o.id === orderId);
            
            if (orderIndex !== -1) {
                const order = orders[orderIndex];
                order.status = 'ready';
                
                // Move to completed orders
                completedOrders.push(order);
                orders.splice(orderIndex, 1);
                
                updateOrdersDisplay();
                generateBill(order);
                showNotification(`Order #${orderId} marked as complete`);
            }
        }

        // Generate bill for completed order
        function generateBill(order) {
            const billSection = document.getElementById('bill-section');
            billSection.style.display = 'block';
            
            // Scroll to bill section
            billSection.scrollIntoView({ behavior: 'smooth' });
            
            // Set bill details
            document.getElementById('bill-number').textContent = `Bill #: ${order.id}`;
            document.getElementById('bill-date').textContent = `Date: ${new Date().toLocaleDateString()}`;
            document.getElementById('bill-customer').textContent = `Customer: ${order.customer}`;
            document.getElementById('bill-table').textContent = `Table: ${order.table}`;
            
            // Add bill items
            const billItems = document.getElementById('bill-items');
            billItems.innerHTML = '';
            
            order.items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td>$${(item.price * item.quantity).toFixed(2)}</td>
                `;
                billItems.appendChild(row);
            });
            
            // Set total
            document.getElementById('bill-total').textContent = order.total.toFixed(2);
        }

        // Download bill as PDF
        function downloadBill() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add restaurant details
            doc.setFontSize(22);
            doc.text("Restaurant Management System", 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text("123 Restaurant Street, Food City", 105, 22, { align: 'center' });
            doc.text("Phone: (555) 123-4567", 105, 28, { align: 'center' });
            
            // Add bill details
            doc.setFontSize(16);
            doc.text("BILL", 105, 40, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Bill #: ${document.getElementById('bill-number').textContent.split(': ')[1]}`, 20, 50);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 56);
            doc.text(`Customer: ${document.getElementById('bill-customer').textContent.split(': ')[1]}`, 20, 62);
            doc.text(`Table: ${document.getElementById('bill-table').textContent.split(': ')[1]}`, 20, 68);
            
            // Add bill items table
            doc.autoTable({
                startY: 75,
                head: [['Item', 'Qty', 'Price', 'Total']],
                body: Array.from(document.querySelectorAll('#bill-items tr')).map(row => {
                    return Array.from(row.querySelectorAll('td')).map(cell => cell.textContent);
                }),
                theme: 'grid',
                headStyles: { fillColor: [44, 62, 80] }
            });
            
            // Add total
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.text(`Total: $${document.getElementById('bill-total').textContent}`, 160, finalY);
            
            // Save the PDF
            doc.save(`bill-${document.getElementById('bill-number').textContent.split(': ')[1]}.pdf`);
        }

        // Add new menu item (admin function)
        function addMenuItem() {
            const name = document.getElementById('item-name').value;
            const description = document.getElementById('item-description').value;
            const price = parseFloat(document.getElementById('item-price').value);
            const image = document.getElementById('item-image').value;
            
            if (!name || !description || isNaN(price) || !image) {
                showNotification('Please fill all fields with valid data', true);
                return;
            }
            
            const newItem = {
                id: menuItems.length > 0 ? Math.max(...menuItems.map(i => i.id)) + 1 : 1,
                name,
                description,
                price,
                image
            };
            
            menuItems.push(newItem);
            renderMenu();
            
            // Clear form
            document.getElementById('item-name').value = '';
            document.getElementById('item-description').value = '';
            document.getElementById('item-price').value = '';
            document.getElementById('item-image').value = '';
            
            showNotification('Menu item added successfully!');
        }

        // Edit menu item (admin function)
        function editItem(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (!item) return;
            
            const newName = prompt('Enter new name:', item.name);
            if (newName === null) return;
            
            const newDescription = prompt('Enter new description:', item.description);
            if (newDescription === null) return;
            
            const newPrice = parseFloat(prompt('Enter new price:', item.price));
            if (isNaN(newPrice)) return;
            
            const newImage = prompt('Enter new image URL:', item.image);
            if (newImage === null) return;
            
            item.name = newName;
            item.description = newDescription;
            item.price = newPrice;
            item.image = newImage;
            
            renderMenu();
            showNotification('Menu item updated successfully!');
        }

        // Delete menu item (admin function)
        function deleteItem(itemId) {
            if (!confirm('Are you sure you want to delete this menu item?')) return;
            
            const itemIndex = menuItems.findIndex(i => i.id === itemId);
            if (itemIndex !== -1) {
                menuItems.splice(itemIndex, 1);
                renderMenu();
                showNotification('Menu item deleted successfully!');
            }
        }

        // Generate daily report
        function generateDailyReport() {
            const date = document.getElementById('report-date').value;
            if (!date) {
                showNotification('Please select a date', true);
                return;
            }
            
            // Filter orders for the selected date
            const selectedDate = new Date(date);
            const nextDay = new Date(selectedDate);
            nextDay.setDate(nextDay.getDate() + 1);
            
            const daysOrders = completedOrders.filter(order => {
                const orderDate = new Date(order.timestamp);
                return orderDate >= selectedDate && orderDate < nextDay;
            });
            
            // Calculate total revenue
            const totalRevenue = daysOrders.reduce((sum, order) => sum + order.total, 0);
            
            // Display report
            const reportResults = document.getElementById('report-results');
            reportResults.innerHTML = `
                <h3>Report for ${selectedDate.toLocaleDateString()}</h3>
                <p>Total Orders: ${daysOrders.length}</p>
                <p>Total Revenue: $${totalRevenue.toFixed(2)}</p>
                
                <h4 style="margin-top: 20px;">Order Details:</h4>
                ${daysOrders.length > 0 ? 
                    daysOrders.map(order => `
                        <div style="padding: 10px; border-bottom: 1px solid #eee;">
                            <p><strong>Order #${order.id}</strong> - Table ${order.table} (${order.customer}) - $${order.total.toFixed(2)}</p>
                            <p>Items: ${order.items.map(item => `${item.name} x${item.quantity}`).join(', ')}</p>
                        </div>
                    `).join('') : 
                    '<p>No orders for this date</p>'
                }
            `;
        }

        // Export all orders to JSON
        function exportOrders() {
            const dataStr = JSON.stringify(completedOrders, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `orders-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Orders exported successfully!');
        }

        // Export today's orders to JSON
        function exportTodayOrders() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            const todaysOrders = completedOrders.filter(order => {
                const orderDate = new Date(order.timestamp).toISOString().split('T')[0];
                return orderDate === todayStr;
            });
            
            const dataStr = JSON.stringify(todaysOrders, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `orders-${todayStr}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification("Today's orders exported successfully!");
        }
    </script>
</body>
</html>